---
title: Vite/Rollup æ„å»ºæµç¨‹è¯¦è§£
date: 2026-01-19
duration: 120min
type: notes
art: random
---

[[toc]]

æœ¬æ–‡æ¡£è¯¦ç»†è®°å½• Vite æ„å»ºè¿‡ç¨‹ã€Sourcemap ç”Ÿæˆæœºåˆ¶ä»¥åŠå†…å­˜ä¼˜åŒ–ç­–ç•¥ã€‚
## ç›®å½•

- [1. æ„å»ºå®Œæ•´æµç¨‹](#1-æ„å»ºå®Œæ•´æµç¨‹)
- [2. å„é˜¶æ®µè¯¦è§£](#2-å„é˜¶æ®µè¯¦è§£)
- [3. Sourcemap ç”Ÿæˆæœºåˆ¶](#3-sourcemap-ç”Ÿæˆæœºåˆ¶)
- [4. å†…å­˜ä¼˜åŒ–ç­–ç•¥](#4-å†…å­˜ä¼˜åŒ–ç­–ç•¥)
- [5. æœ€ä½³å®è·µé…ç½®](#5-æœ€ä½³å®è·µé…ç½®)

---

## 1. æ„å»ºå®Œæ•´æµç¨‹

```
vite build
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1ï¸âƒ£ é…ç½®è§£æé˜¶æ®µ (Config Resolution)                                            â”‚
â”‚     â€¢ è¯»å– vite.config.mjs                                                       â”‚
â”‚     â€¢ åˆå¹¶é»˜è®¤é…ç½® + ç”¨æˆ·é…ç½®                                                     â”‚
â”‚     â€¢ åˆå§‹åŒ–æ‰€æœ‰æ’ä»¶                                                              â”‚
â”‚     â€¢ é’©å­: config â†’ configResolved                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2ï¸âƒ£ æ„å»ºå¼€å§‹é˜¶æ®µ (Build Start)                                                  â”‚
â”‚     â€¢ æ¸…ç©ºè¾“å‡ºç›®å½• (dist/)                                                       â”‚
â”‚     â€¢ å‡†å¤‡æ„å»ºç¯å¢ƒ                                                               â”‚
â”‚     â€¢ é’©å­: buildStart                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3ï¸âƒ£ æ¨¡å—è§£æé˜¶æ®µ (Module Resolution)                                            â”‚
â”‚     â€¢ ä»å…¥å£æ–‡ä»¶ (main.js) å¼€å§‹                                                  â”‚
â”‚     â€¢ é€’å½’è§£ææ‰€æœ‰ import ä¾èµ–                                                   â”‚
â”‚     â€¢ é’©å­: resolveId â†’ load (å¾ªç¯)                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4ï¸âƒ£ æ¨¡å—è½¬æ¢é˜¶æ®µ (Transform) â­ sourcemap-filter åœ¨è¿™é‡Œ                         â”‚
â”‚     â€¢ å¯¹æ¯ä¸ªæ¨¡å—è¿›è¡Œä»£ç è½¬æ¢                                                     â”‚
â”‚     â€¢ .vue â†’ .jsã€TypeScript â†’ JavaScript                                       â”‚
â”‚     â€¢ ç”Ÿæˆæ¯ä¸ªæ¨¡å—çš„ sourcemap æ˜ å°„æ•°æ®ï¼ˆå†…å­˜å¯¹è±¡ï¼Œéæ–‡ä»¶ï¼‰                      â”‚
â”‚     â€¢ é’©å­: transform                                                           â”‚
â”‚     â€¢ å†…å­˜æ¶ˆè€—: ä¸­ç­‰ï¼ˆå•æ–‡ä»¶å¤„ç†ï¼‰                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5ï¸âƒ£ ä¾èµ–å›¾åˆ†æé˜¶æ®µ (Module Graph Analysis)                                      â”‚
â”‚     â€¢ æ„å»ºå®Œæ•´çš„æ¨¡å—ä¾èµ–å›¾                                                       â”‚
â”‚     â€¢ è¯†åˆ«åŠ¨æ€ import() çš„åˆ†å‰²ç‚¹                                                 â”‚
â”‚     â€¢ é’©å­: buildEnd                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6ï¸âƒ£ Chunk åˆ†å‰²é˜¶æ®µ (Chunking) â­ manualChunks åœ¨è¿™é‡Œ                             â”‚
â”‚     â€¢ æ ¹æ® manualChunks é…ç½®åˆ†å‰²ä»£ç                                              â”‚
â”‚     â€¢ å†³å®šå“ªäº›æ¨¡å—æ‰“åŒ…åˆ°åŒä¸€ä¸ª chunk                                             â”‚
â”‚     â€¢ é’©å­: outputOptions, renderStart                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  7ï¸âƒ£ Chunk æ¸²æŸ“é˜¶æ®µ (Render Chunks) ğŸ’¥ å†…å­˜æ¶ˆè€—é«˜å³°ï¼                             â”‚
â”‚     â€¢ åˆå¹¶æ¨¡å—ä»£ç åˆ° chunk                                                       â”‚
â”‚     â€¢ è§£æ ASTã€ä»£ç å‹ç¼©                                                         â”‚
â”‚     â€¢ é“¾æ¥å„æ¨¡å—çš„ sourcemap æ˜ å°„æ•°æ®                                            â”‚
â”‚     â€¢ ç”Ÿæˆ chunk çº§åˆ«çš„ sourcemap æ˜ å°„æ•°æ®ï¼ˆå†…å­˜å¯¹è±¡ï¼‰                           â”‚
â”‚     â€¢ é’©å­: renderChunk                                                         â”‚
â”‚     â€¢ å†…å­˜æ¶ˆè€—: éå¸¸é«˜ï¼ˆå¤„ç†æ•´ä¸ª chunkï¼‰                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  8ï¸âƒ£ Bundle ç”Ÿæˆé˜¶æ®µ (Generate Bundle)                                           â”‚
â”‚     â€¢ å¤„ç† CSS æ–‡ä»¶                                                              â”‚
â”‚     â€¢ å¤„ç†é™æ€èµ„æº (å›¾ç‰‡ã€å­—ä½“ç­‰)                                                â”‚
â”‚     â€¢ ç”Ÿæˆ HTML æ–‡ä»¶                                                             â”‚
â”‚     â€¢ é’©å­: generateBundle                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  9ï¸âƒ£ å†™å…¥ç£ç›˜é˜¶æ®µ (Write Bundle) ğŸ“„ ç”Ÿæˆ .map æ–‡ä»¶                               â”‚
â”‚     â€¢ å°†æ‰€æœ‰æ–‡ä»¶å†™å…¥ dist/ ç›®å½•                                                  â”‚
â”‚     â€¢ å°†å†…å­˜ä¸­çš„ sourcemap æ•°æ®åºåˆ—åŒ–ä¸º .js.map æ–‡ä»¶                             â”‚
â”‚     â€¢ å¤åˆ¶ public/ ç›®å½•çš„é™æ€èµ„æº                                                â”‚
â”‚     â€¢ é’©å­: writeBundle                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”Ÿ æ„å»ºå®Œæˆé˜¶æ®µ (Close Bundle)                                                  â”‚
â”‚     â€¢ è¾“å‡ºæ„å»ºç»Ÿè®¡ä¿¡æ¯                                                           â”‚
â”‚     â€¢ æ¸…ç†ä¸´æ—¶æ–‡ä»¶                                                               â”‚
â”‚     â€¢ é’©å­: closeBundle                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. å„é˜¶æ®µè¯¦è§£

### 2.1 æ¨¡å—è§£æé˜¶æ®µ

ä»å…¥å£æ–‡ä»¶å¼€å§‹ï¼Œé€’å½’è§£ææ‰€æœ‰ä¾èµ–ï¼š

```
src/main.js
    â”‚
    â”œâ”€â”€ import { createApp } from 'vue'
    â”‚       â””â”€â”€ resolveId('vue') â†’ node_modules/vue/dist/vue.runtime.esm.js
    â”‚
    â”œâ”€â”€ import ElementPlus from 'element-plus'
    â”‚       â””â”€â”€ resolveId('element-plus') â†’ node_modules/element-plus/es/index.mjs
    â”‚
    â””â”€â”€ import App from './App.vue'
            â””â”€â”€ resolveId('./App.vue') â†’ src/App.vue
```

### 2.2 æ¨¡å—è½¬æ¢é˜¶æ®µ

æ¯ä¸ªæ–‡ä»¶è¢«å•ç‹¬è½¬æ¢ï¼Œç”Ÿæˆå†…å­˜ä¸­çš„æ˜ å°„æ•°æ®ï¼ˆä¸æ˜¯ .map æ–‡ä»¶ï¼‰ï¼š

```javascript
// .vue æ–‡ä»¶è½¬æ¢ç¤ºä¾‹
src/App.vue
    â”‚
    â”œâ”€â”€ @vitejs/plugin-vue çš„ transform()
    â”‚       â””â”€â”€ ç¼–è¯‘æ¨¡æ¿ã€æå– scriptã€å¤„ç† style
    â”‚       â””â”€â”€ è¿”å› { code: "ç¼–è¯‘åçš„JS", map: { mappings: "AAA..." } }  // å†…å­˜å¯¹è±¡
    â”‚
    â””â”€â”€ sourcemap-filter çš„ transform()
            â””â”€â”€ è¿”å› { code, map: {...} } æˆ– { code, map: null }
            â””â”€â”€ âš ï¸ è¿™é‡Œçš„ map æ˜¯å†…å­˜ä¸­çš„ JS å¯¹è±¡ï¼Œä¸æ˜¯æ–‡ä»¶ï¼
```

**Transform é˜¶æ®µäº§å‡ºçš„æ˜ å°„æ•°æ®ç»“æ„ï¼š**

```javascript
{
  code: "export default { ... }",   // è½¬æ¢åçš„ä»£ç 
  map: {                            // ğŸ“¦ å†…å­˜ä¸­çš„æ˜ å°„å¯¹è±¡
    version: 3,
    sources: ["App.vue"],
    mappings: "AAAA,SAAS...",       // åŸå§‹è¡Œå· â†” è½¬æ¢åè¡Œå·
    sourcesContent: ["<template>..."]
  }
}
```

### 2.3 ä¾èµ–å›¾åˆ†æé˜¶æ®µ

æ„å»ºå®Œæ•´çš„æ¨¡å—ä¾èµ–å…³ç³»å›¾ï¼Œä¸ºåç»­çš„ä»£ç åˆ†å‰²åšå‡†å¤‡ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¾èµ–å›¾åˆ†æè¿‡ç¨‹                                                                  â”‚
â”‚                                                                                  â”‚
â”‚  1. éå†æ‰€æœ‰å·²è½¬æ¢çš„æ¨¡å—ï¼Œå»ºç«‹ä¾èµ–å…³ç³»                                            â”‚
â”‚  2. è¯†åˆ«å…¥å£ç‚¹å’ŒåŠ¨æ€å¯¼å…¥ç‚¹                                                       â”‚
â”‚  3. åˆ†ææ¨¡å—çš„å¼•ç”¨å…³ç³»ï¼ˆè¢«å“ªäº›æ¨¡å—å¼•ç”¨ã€å¼•ç”¨äº†å“ªäº›æ¨¡å—ï¼‰                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  æ„å»ºçš„ä¾èµ–å›¾ç¤ºä¾‹ï¼š
  
  main.js (å…¥å£)
     â”‚
     â”œâ”€â”€ import App from './App.vue'
     â”‚       â””â”€â”€ App.vue
     â”‚             â”œâ”€â”€ import { ref } from 'vue'
     â”‚             â”‚       â””â”€â”€ vue (è¢«å¤šä¸ªæ¨¡å—å…±äº«)
     â”‚             â””â”€â”€ import Header from './Header.vue'
     â”‚
     â”œâ”€â”€ import router from './router'
     â”‚       â””â”€â”€ router/index.js
     â”‚             â”œâ”€â”€ import { createRouter } from 'vue-router'
     â”‚             â””â”€â”€ import() => './views/Home.vue'  â† åŠ¨æ€å¯¼å…¥ï¼ˆåˆ†å‰²ç‚¹ï¼‰
     â”‚
     â””â”€â”€ import store from './store'
             â””â”€â”€ store/index.js
                   â””â”€â”€ import { createStore } from 'vuex'
```

**ä¾èµ–å›¾åˆ†æçš„å…³é”®ä½œç”¨ï¼š**

| åˆ†æå†…å®¹ | ä½œç”¨ |
|---------|------|
| **é™æ€å¯¼å…¥ (import)** | ç¡®å®šå“ªäº›æ¨¡å—å¿…é¡»æ‰“åŒ…åœ¨ä¸€èµ· |
| **åŠ¨æ€å¯¼å…¥ (import())** | è¯†åˆ«ä»£ç åˆ†å‰²ç‚¹ï¼Œç”Ÿæˆç‹¬ç«‹ chunk |
| **å…±äº«ä¾èµ–** | å†³å®šå…±äº«æ¨¡å—æ”¾å…¥å“ªä¸ª chunk |
| **å¾ªç¯ä¾èµ–** | æ£€æµ‹å¹¶å¤„ç†å¾ªç¯å¼•ç”¨é—®é¢˜ |

**buildEnd é’©å­ï¼š** åˆ†æå®Œæˆåè°ƒç”¨ï¼Œå¯ç”¨äºç»Ÿè®¡æˆ–éªŒè¯ä¾èµ–ä¿¡æ¯ã€‚

### 2.4 Chunk åˆ†å‰²é˜¶æ®µ

æ ¹æ®é…ç½®å†³å®šä»£ç åˆ†å‰²ç­–ç•¥ï¼š

```
æ²¡æœ‰ manualChunks:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  vendor.js = vue + vue-router + element-plus + vxe-table + ...  â”‚
â”‚  (ä¸€ä¸ªå·¨å¤§çš„ chunkï¼Œ5-10MB)                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æœ‰ manualChunks:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ vendor-vue â”‚ â”‚ vendor-element â”‚ â”‚ vendor-vxe â”‚ â”‚ vendor-echarts â”‚
â”‚ (~200KB)   â”‚ â”‚ (~800KB)       â”‚ â”‚ (~500KB)   â”‚ â”‚ (~1MB)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.5 Chunk æ¸²æŸ“é˜¶æ®µï¼ˆå†…å­˜é«˜å³°ï¼‰

è¿™æ˜¯å†…å­˜æ¶ˆè€—æœ€é«˜çš„é˜¶æ®µï¼š

| å¤„ç†æ­¥éª¤ | å†…å­˜æ¶ˆè€— |
|---------|---------|
| åˆå¹¶æ¨¡å—ä»£ç  | ~ä»£ç å¤§å° |
| è§£æ AST | ~ä»£ç å¤§å° Ã— 10 |
| å»ºç«‹ä½ç½®æ˜ å°„è¡¨ | ~ä»£ç å¤§å° Ã— 20 |
| é“¾æ¥ sourcemap | ~ä»£ç å¤§å° Ã— 5 |
| ä»£ç å‹ç¼© (esbuild) | ~ä»£ç å¤§å° Ã— 5 |
| ç”Ÿæˆæœ€ç»ˆ sourcemap | ~ä»£ç å¤§å° Ã— 5 |

**å³°å€¼å†…å­˜ â‰ˆ ä»£ç å¤§å° Ã— 40-50 å€**

---

## 3. Sourcemap ç”Ÿæˆæœºåˆ¶

### 3.1 ä»€ä¹ˆæ˜¯ Sourcemapï¼Ÿ

Sourcemap æ˜¯ä¸€ä¸ª JSON æ–‡ä»¶ï¼Œç”¨äºå°†å‹ç¼©åçš„ä»£ç æ˜ å°„å›åŸå§‹æºä»£ç ã€‚

```json
{
  "version": 3,
  "file": "app.js",
  "sources": ["src/App.vue", "src/utils/index.js"],
  "sourcesContent": ["åŸå§‹ä»£ç ...", "åŸå§‹ä»£ç ..."],
  "mappings": "AAAA,SAAS,QAAQ..."  // VLQ ç¼–ç çš„ä½ç½®æ˜ å°„
}
```

### 3.2 ä»€ä¹ˆæ˜¯ VLQ ç¼–ç ï¼Ÿ

**VLQ (Variable-Length Quantity)** æ˜¯ä¸€ç§å¯å˜é•¿åº¦ç¼–ç æ–¹å¼ï¼Œç”¨äºå°†ä½ç½®æ˜ å°„ä¿¡æ¯å‹ç¼©æˆç´§å‡‘çš„å­—ç¬¦ä¸²ã€‚

#### ä¸ºä»€ä¹ˆéœ€è¦ VLQ ç¼–ç ï¼Ÿ

å¦‚æœç›´æ¥å­˜å‚¨æ¯ä¸ªä½ç½®çš„è¡Œ/åˆ—å·ï¼Œsourcemap æ–‡ä»¶ä¼šéå¸¸å¤§ï¼š

```
æœªç¼–ç çš„æ˜ å°„ï¼ˆç¤ºæ„ï¼‰ï¼š
ç¬¬1è¡Œç¬¬5åˆ— â†’ æºæ–‡ä»¶1ç¬¬10è¡Œç¬¬3åˆ—
ç¬¬1è¡Œç¬¬10åˆ— â†’ æºæ–‡ä»¶1ç¬¬10è¡Œç¬¬8åˆ—
ç¬¬1è¡Œç¬¬15åˆ— â†’ æºæ–‡ä»¶2ç¬¬5è¡Œç¬¬1åˆ—
... å‡ ä¸‡æ¡è¿™æ ·çš„æ˜ å°„
```

VLQ ç¼–ç é€šè¿‡ä»¥ä¸‹æ–¹å¼å‹ç¼©ï¼š
1. **ä½¿ç”¨ç›¸å¯¹ä½ç½®**ï¼šæ¯æ¬¡åªè®°å½•ç›¸å¯¹äºä¸Šä¸€ä¸ªä½ç½®çš„åç§»é‡
2. **Base64 ç¼–ç **ï¼šå°†æ•°å­—ç¼–ç ä¸ºå¯æ‰“å°å­—ç¬¦

#### VLQ ç¼–ç ç¤ºä¾‹

```
mappings: "AAAA,SAAS,IAAM,QAAQ"
          â”‚     â”‚     â”‚     â”‚
          â”‚     â”‚     â”‚     â””â”€â”€ ç¬¬4ä¸ªæ˜ å°„æ®µ
          â”‚     â”‚     â””â”€â”€ ç¬¬3ä¸ªæ˜ å°„æ®µ
          â”‚     â””â”€â”€ ç¬¬2ä¸ªæ˜ å°„æ®µ
          â””â”€â”€ ç¬¬1ä¸ªæ˜ å°„æ®µï¼ˆé€—å·åˆ†éš”åˆ—ï¼Œåˆ†å·åˆ†éš”è¡Œï¼‰

æ¯ä¸ªæ˜ å°„æ®µåŒ…å« 1-5 ä¸ªå­—æ®µï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å­—æ®µ      â”‚ å«ä¹‰                                                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  å­—æ®µ 1    â”‚ ç”Ÿæˆä»£ç çš„åˆ—åç§»é‡                                                 â”‚
â”‚  å­—æ®µ 2    â”‚ æºæ–‡ä»¶ç´¢å¼•ï¼ˆåœ¨ sources æ•°ç»„ä¸­çš„ä½ç½®ï¼‰                              â”‚
â”‚  å­—æ®µ 3    â”‚ æºä»£ç çš„è¡Œåç§»é‡                                                   â”‚
â”‚  å­—æ®µ 4    â”‚ æºä»£ç çš„åˆ—åç§»é‡                                                   â”‚
â”‚  å­—æ®µ 5    â”‚ å˜é‡åç´¢å¼•ï¼ˆå¯é€‰ï¼Œåœ¨ names æ•°ç»„ä¸­çš„ä½ç½®ï¼‰                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç¤ºä¾‹è§£ç ï¼š
"AAAA" = [0,0,0,0]
  â†’ ç”Ÿæˆä»£ç ç¬¬0åˆ— â†’ å¯¹åº”æºæ–‡ä»¶0çš„ç¬¬0è¡Œç¬¬0åˆ—

"SAAS" = [9,0,0,9]  
  â†’ ç”Ÿæˆä»£ç ç¬¬9åˆ— â†’ å¯¹åº”åŒä¸€æºæ–‡ä»¶ï¼ŒåŒä¸€è¡Œï¼Œç¬¬9åˆ—
```

#### VLQ ç¼–ç è¡¨

Base64 å­—ç¬¦å¯¹åº”è¡¨ï¼ˆéƒ¨åˆ†ï¼‰ï¼š

| å­—ç¬¦ | å€¼ | å­—ç¬¦ | å€¼ | å­—ç¬¦ | å€¼ |
|-----|---|-----|---|-----|---|
| A | 0 | I | 8 | Q | 16 |
| B | 1 | J | 9 | R | 17 |
| C | 2 | K | 10 | S | 18 |
| D | 3 | L | 11 | T | 19 |
| E | 4 | M | 12 | U | 20 |
| F | 5 | N | 13 | V | 21 |
| G | 6 | O | 14 | W | 22 |
| H | 7 | P | 15 | ... | ... |

#### ä¸ºä»€ä¹ˆ VLQ ç¼–ç æ¶ˆè€—å†…å­˜ï¼Ÿ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  VLQ ç¼–ç /è§£ç è¿‡ç¨‹çš„å†…å­˜æ¶ˆè€—                                                     â”‚
â”‚                                                                                  â”‚
â”‚  ç¼–ç æ—¶ï¼ˆå†™å…¥ sourcemapï¼‰ï¼š                                                      â”‚
â”‚  1. ç»´æŠ¤å½“å‰ä½ç½®çŠ¶æ€ï¼ˆä¸Šä¸€ä¸ªä½ç½®çš„è¡Œã€åˆ—ã€æºæ–‡ä»¶ç´¢å¼•ï¼‰                            â”‚
â”‚  2. ä¸ºæ¯ä¸ªæ˜ å°„è®¡ç®—åç§»é‡                                                         â”‚
â”‚  3. å°†åç§»é‡è½¬æ¢ä¸º VLQ å­—ç¬¦                                                      â”‚
â”‚  4. æ‹¼æ¥æ‰€æœ‰æ˜ å°„å­—ç¬¦ä¸²                                                           â”‚
â”‚                                                                                  â”‚
â”‚  è§£ç æ—¶ï¼ˆè¯»å– sourcemapï¼Œç”¨äºè°ƒè¯•ï¼‰ï¼š                                            â”‚
â”‚  1. è§£æ VLQ å­—ç¬¦ä¸²ä¸ºæ•°å­—                                                        â”‚
â”‚  2. ç´¯åŠ åç§»é‡å¾—åˆ°ç»å¯¹ä½ç½®                                                       â”‚
â”‚  3. æ„å»ºä½ç½®æŸ¥æ‰¾è¡¨                                                               â”‚
â”‚                                                                                  â”‚
â”‚  ğŸ’¥ å½“æ˜ å°„ç‚¹å¤šè¾¾ç™¾ä¸‡çº§æ—¶ï¼Œè¿™ä¸ªè¿‡ç¨‹éœ€è¦å¤§é‡å†…å­˜ï¼                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 ä¸ºä»€ä¹ˆ Sourcemap æ¶ˆè€—å¤§é‡å†…å­˜ï¼Ÿ

ç”Ÿæˆè¿‡ç¨‹éœ€è¦åŒæ—¶åœ¨å†…å­˜ä¸­ç»´æŠ¤ï¼š

1. **åŸå§‹æºç çš„è¡Œ/åˆ—ä¿¡æ¯** - æ¯ä¸ª token çš„ä½ç½®
2. **è½¬æ¢åä»£ç çš„è¡Œ/åˆ—ä¿¡æ¯** - æ–°ä½ç½®
3. **ä¸¤è€…ä¹‹é—´çš„æ˜ å°„å…³ç³»** - O(n) æˆ– O(nÂ²) å¤æ‚åº¦
4. **VLQ ç¼–ç è¿‡ç¨‹** - ä½ç½®ä¿¡æ¯ç¼–ç 

### 3.4 Sourcemap ç”Ÿæˆçš„ä¸‰ä¸ªé˜¶æ®µ

Sourcemap çš„ç”Ÿæˆæ¶‰åŠä¸‰ä¸ªé˜¶æ®µï¼Œç†è§£è¿™ä¸€ç‚¹éå¸¸é‡è¦ï¼š

```
é˜¶æ®µ 1: Transformï¼ˆç¬¬ 4 é˜¶æ®µï¼‰- ç”Ÿæˆæ¨¡å—çº§æ˜ å°„æ•°æ®
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æ¯ä¸ªæ¨¡å—è¢«å•ç‹¬å¤„ç†ï¼Œç”Ÿæˆå†…å­˜ä¸­çš„æ˜ å°„å¯¹è±¡ï¼š

  App.vue   â†’  { code, map: { mappings: "AAA..." } }   // Vue â†’ JS çš„æ˜ å°„
  utils.ts  â†’  { code, map: { mappings: "BBB..." } }   // TS â†’ JS çš„æ˜ å°„
  store.js  â†’  { code, map: null }                     // æ²¡æœ‰è½¬æ¢ï¼Œæ— æ˜ å°„

  âš ï¸ è¿™äº›æ˜¯å†…å­˜ä¸­çš„ JavaScript å¯¹è±¡ï¼Œä¸æ˜¯æ–‡ä»¶ï¼
        â”‚
        â”‚  æ˜ å°„æ•°æ®ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œç­‰å¾…åç»­é˜¶æ®µä½¿ç”¨
        â–¼

é˜¶æ®µ 2: Chunk æ¸²æŸ“ï¼ˆç¬¬ 7 é˜¶æ®µï¼‰- é“¾æ¥åˆå¹¶æ˜ å°„æ•°æ® ğŸ’¥ å†…å­˜é«˜å³°
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
å¤šä¸ªæ¨¡å—åˆå¹¶æˆ chunkï¼Œé“¾æ¥å®ƒä»¬çš„æ˜ å°„æ•°æ®ï¼š

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  ç”Ÿæˆ chunk-xxx.js:                                          â”‚
  â”‚                                                              â”‚
  â”‚    ç¬¬ 1-100 è¡Œ   â† æ¥è‡ª App.vue (æŸ¥æ‰¾å…¶æ˜ å°„æ•°æ®)             â”‚
  â”‚    ç¬¬ 101-200 è¡Œ â† æ¥è‡ª utils.ts (æŸ¥æ‰¾å…¶æ˜ å°„æ•°æ®)            â”‚
  â”‚    ç¬¬ 201-300 è¡Œ â† æ¥è‡ª store.js (æ— æ˜ å°„ï¼Œè·³è¿‡)              â”‚
  â”‚                                                              â”‚
  â”‚  Rollup éœ€è¦ï¼š                                               â”‚
  â”‚  1. é“¾æ¥å„æ¨¡å—çš„æ˜ å°„æ•°æ®                                      â”‚
  â”‚  2. è®¡ç®— chunk ä¸­æ¯è¡Œä»£ç å¯¹åº”çš„åŸå§‹ä½ç½®                       â”‚
  â”‚  3. ç”Ÿæˆ chunk çº§åˆ«çš„æ˜ å°„æ•°æ®                                 â”‚
  â”‚                                                              â”‚
  â”‚  è¾“å‡ºï¼š{ code: "å®Œæ•´chunkä»£ç ", map: { åˆå¹¶åçš„æ˜ å°„ } }       â”‚
  â”‚                                                              â”‚
  â”‚  ğŸ’¥ è¿™ä¸ªé˜¶æ®µéœ€è¦åŒæ—¶å¤„ç†æ•´ä¸ª chunk çš„æ‰€æœ‰æ¨¡å—ï¼Œå†…å­˜æ¶ˆè€—é«˜ï¼   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚  è¿™ä»ç„¶æ˜¯å†…å­˜ä¸­çš„å¯¹è±¡
        â–¼

é˜¶æ®µ 3: å†™å…¥ç£ç›˜ï¼ˆç¬¬ 9 é˜¶æ®µï¼‰- ç”Ÿæˆ .map æ–‡ä»¶
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
å°†å†…å­˜ä¸­çš„æ•°æ®åºåˆ—åŒ–å†™å…¥æ–‡ä»¶ï¼š

  dist/
  â”œâ”€â”€ assets/
  â”‚   â”œâ”€â”€ chunk-xxx.js        â† å‹ç¼©åçš„ä»£ç 
  â”‚   â””â”€â”€ chunk-xxx.js.map    â† ğŸ¯ æœ€ç»ˆçš„ sourcemap æ–‡ä»¶ï¼
```

### 3.5 å„é˜¶æ®µäº§å‡ºå¯¹ç…§è¡¨

| é˜¶æ®µ | äº§å‡º | å­˜å‚¨ä½ç½® | æ˜¯å¦ä¸ºæœ€ç»ˆæ–‡ä»¶ |
|------|------|---------|---------------|
| **Transformï¼ˆç¬¬ 4 é˜¶æ®µï¼‰** | æ¯ä¸ªæ¨¡å—çš„æ˜ å°„æ•°æ® | å†…å­˜ä¸­çš„ JS å¯¹è±¡ | âŒ å¦ |
| **Chunk æ¸²æŸ“ï¼ˆç¬¬ 7 é˜¶æ®µï¼‰** | åˆå¹¶åçš„ chunk æ˜ å°„æ•°æ® | å†…å­˜ä¸­çš„ JS å¯¹è±¡ | âŒ å¦ |
| **å†™å…¥ç£ç›˜ï¼ˆç¬¬ 9 é˜¶æ®µï¼‰** | `.js.map` æ–‡ä»¶ | ç¡¬ç›˜ `dist/` ç›®å½• | âœ… **æ˜¯** |

### 3.6 å…³é”®ç»“è®º

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”‘ é‡è¦ç†è§£                                                                     â”‚
â”‚                                                                                  â”‚
â”‚  Transform é˜¶æ®µçš„ map: null æ„å‘³ç€ï¼š                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                              â”‚
â”‚  âœ… ä¸ä¸ºè¯¥æ¨¡å—ç”Ÿæˆæ˜ å°„æ•°æ®                                                       â”‚
â”‚  âœ… åœ¨ Chunk æ¸²æŸ“é˜¶æ®µé“¾æ¥æ—¶ä¼šè·³è¿‡è¯¥æ¨¡å—çš„æ˜ å°„                                    â”‚
â”‚  âœ… æœ€ç»ˆ .map æ–‡ä»¶ä¸­ä¸åŒ…å«è¯¥æ¨¡å—çš„åŸå§‹ä½ç½®ä¿¡æ¯                                   â”‚
â”‚  âœ… å‡å°‘ Chunk æ¸²æŸ“é˜¶æ®µçš„å†…å­˜æ¶ˆè€—                                                â”‚
â”‚                                                                                  â”‚
â”‚  ä½†æ˜¯ï¼š                                                                          â”‚
â”‚  âŒ ä¸èƒ½é˜»æ­¢ä»£ç æœ¬èº«è¢«æ‰“åŒ…ï¼ˆä»£ç è¿˜æ˜¯ä¼šè¿›å…¥ chunkï¼‰                                â”‚
â”‚  âŒ ä¸èƒ½å‡å°‘ AST è§£æå’Œä»£ç å‹ç¼©çš„å†…å­˜æ¶ˆè€—                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. å†…å­˜ä¼˜åŒ–ç­–ç•¥

### 4.1 é—®é¢˜åˆ†æ

å†…å­˜æº¢å‡ºé€šå¸¸å‘ç”Ÿåœ¨ **Chunk æ¸²æŸ“é˜¶æ®µ**ï¼Œä¸»è¦åŸå› ï¼š

- chunk ä½“ç§¯è¿‡å¤§ï¼ˆåŒ…å«å¤§é‡ node_modulesï¼‰
- sourcemap æ˜ å°„æ•°æ®é‡å¤§
- Node.js é»˜è®¤å†…å­˜é™åˆ¶çº¦ 4GB

### 4.2 ä¼˜åŒ–æ–¹æ¡ˆå¯¹æ¯”

| ä¼˜åŒ–æ–¹å¼ | ä½œç”¨é˜¶æ®µ | ä¼˜åŒ–åŸç† | æ•ˆæœ |
|---------|---------|---------|------|
| **manualChunks** | Chunk åˆ†å‰²é˜¶æ®µ | æ‹†åˆ†å¤§ chunk ä¸ºå¤šä¸ªå° chunk | é™ä½å•æ¬¡å¤„ç†å³°å€¼ |
| **sourcemap-filter** | Transform é˜¶æ®µ | åªä¸ºä¸šåŠ¡ä»£ç ç”Ÿæˆæ˜ å°„ | å‡å°‘ sourcemap ç›¸å…³å†…å­˜ |

### 4.3 manualChunks å·¥ä½œåŸç†

```
æ²¡æœ‰ manualChunks:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¤„ç†ä¸€ä¸ª 10MB çš„ vendor chunk                                   â”‚
â”‚  å³°å€¼å†…å­˜ = 10MB Ã— 50 = 500MB+                                   â”‚
â”‚  ğŸ’¥ å¯èƒ½å†…å­˜æº¢å‡º                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æœ‰ manualChunks:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¤„ç† 2MB chunk â”‚ â†’GCâ†’â”‚ å¤„ç† 2MB chunk â”‚ â†’GCâ†’â”‚ å¤„ç† 2MB chunk â”‚
â”‚ å³°å€¼ = 100MB   â”‚     â”‚ å³°å€¼ = 100MB   â”‚     â”‚ å³°å€¼ = 100MB   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
âœ… åˆ†æ‰¹å¤„ç†ï¼ŒGC å¯ä»¥å›æ”¶ï¼Œå†…å­˜å¯æ§
```

### 4.4 sourcemap-filter å·¥ä½œåŸç†

```javascript
// åœ¨ transform é˜¶æ®µ
transform(code, id) {
  if (id.includes('node_modules')) {
    // ä¸ä¸º node_modules ç”Ÿæˆ sourcemap æ˜ å°„
    return { code, map: null };
  }
  // ä¸šåŠ¡ä»£ç ä¿ç•™ sourcemap
  return null;
}
```

**æ•ˆæœï¼š**

| å†…å­˜ç»„æˆ | æ²¡æœ‰ filter | æœ‰ sourcemap-filter |
|---------|------------|-------------------|
| ä»£ç æœ¬èº« (AST) | 500MB | 500MB âŒ ä¸å˜ |
| å‹ç¼©è¿‡ç¨‹ | 300MB | 300MB âŒ ä¸å˜ |
| Sourcemap æ˜ å°„æ•°æ® | 800MB | 100MB âœ… å‡å°‘ |
| Sourcemap é“¾æ¥/åˆå¹¶ | 400MB | 50MB âœ… å‡å°‘ |
| **æ€»è®¡** | 2000MB | 950MB âœ… å‡å°‘ ~55% |

### 4.5 ä¸¤è€…ç»“åˆçš„æ•ˆæœ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                  â”‚
â”‚   manualChunks                            sourcemap-filter                       â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                     â”‚
â”‚   ä¼˜åŒ–"å®½åº¦"ï¼šåˆ†æ‰¹å¤„ç†                    ä¼˜åŒ–"æ·±åº¦"ï¼šå‡å°‘æ•°æ®é‡                 â”‚
â”‚                                                                                  â”‚
â”‚            â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚ åˆ†æ‰¹å¤„ç† â†’ â”‚ A â”‚ B â”‚ C â”‚                 åªå¤„ç† â†’ â”‚ ä¸šåŠ¡ä»£ç  â”‚                  â”‚
â”‚            â”‚   â”‚   â”‚   â”‚                 ä¸šåŠ¡æ˜ å°„  â”‚ çš„æ˜ å°„   â”‚                  â”‚
â”‚            â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚              â†‘   â†‘   â†‘                                                           â”‚
â”‚          ä¸€æ¬¡åªå¤„ç†ä¸€ä¸ª                                                           â”‚
â”‚                                                                                  â”‚
â”‚   æ•ˆæœï¼šå³°å€¼å†…å­˜ Ã· N                      æ•ˆæœï¼šå†…å­˜ Ã— 45%                       â”‚
â”‚                                                                                  â”‚
â”‚   ä¸¤è€…ç»“åˆ = æ—¢æ§åˆ¶"å®½åº¦"åˆæ§åˆ¶"æ·±åº¦" = å†…å­˜æœ€ä¼˜ï¼                               â”‚
â”‚                                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. æœ€ä½³å®è·µé…ç½®

### 5.1 vite.config.mjs é…ç½®

```javascript
import { defineConfig, loadEnv } from 'vite';
import { resolve } from 'path';
import createVitePlugins from './vite/plugins';

export default ({ mode, command }) => {
  const env = loadEnv(mode, process.cwd());
  const { VITE_APP_ENV } = env;
  const isProd = VITE_APP_ENV === 'production';

  return defineConfig({
    plugins: createVitePlugins(env, command === 'build'),
    build: {
      target: 'esnext',
      minify: 'esbuild',
      // ç”Ÿæˆ hidden sourcemapï¼Œä¸Šä¼ åˆ° Sentry åå¯å®šä½æºç æŠ¥é”™
      sourcemap: 'hidden',
      rollupOptions: {
        output: {
          // âœ… æ‹†åˆ† vendor chunkï¼Œé™ä½å•æ¬¡å¤„ç†å³°å€¼å†…å­˜
          manualChunks: {
            'vendor-vue': ['vue', 'vue-router', 'vuex', 'vue-demi'],
            'vendor-element': ['element-plus', '@element-plus/icons-vue'],
            'vendor-vxe': ['vxe-table', 'vxe-pc-ui', 'xe-utils'],
            'vendor-echarts': ['echarts'],
            'vendor-utils': ['lodash-es', 'dayjs', 'axios'],
          },
        },
      },
    },
  });
};
```

### 5.2 sourcemap-filter æ’ä»¶

```javascript
/**
 * Vite æ’ä»¶ï¼šç²¾ç»†åŒ–è¿‡æ»¤ sourcemap
 * åªä¸ºä¸šåŠ¡ä»£ç ç”Ÿæˆ sourcemapï¼Œæ’é™¤ node_modules å’Œç¬¬ä¸‰æ–¹åº“
 */
export default function createSourcemapFilter(options = {}) {
  const defaultPatterns = [
    /\/src\/views\/.*\.(vue|js|ts|jsx|tsx)$/,
    /\/src\/components\/.*\.(vue|js|ts|jsx|tsx)$/,
    /\/src\/utils\/.*\.(js|ts)$/,
    /\/src\/api\/.*\.(js|ts)$/,
    /\/src\/store\/.*\.(js|ts)$/,
    /\/src\/router\/.*\.(js|ts)$/,
    /\/src\/hooks\/.*\.(js|ts)$/,
    /\/src\/main\.[jt]s$/,
    /\/src\/App\.vue$/,
  ];

  const allowedPatterns = options.patterns || defaultPatterns;

  return {
    name: 'sourcemap-filter-business-only',
    apply: 'build',

    transform(code, id) {
      // æ’é™¤ node_modules
      if (id.includes('node_modules')) {
        return { code, map: null };
      }

      const normalizedId = id.replace(/\\/g, '/');
      const isAllowed = allowedPatterns.some(pattern => pattern.test(normalizedId));

      if (!isAllowed) {
        return { code, map: null };
      }

      // ä¸šåŠ¡ä»£ç ï¼Œä¿ç•™ sourcemap
      return null;
    },
  };
}
```

### 5.3 å¢åŠ  Node.js å†…å­˜é™åˆ¶

åœ¨ `package.json` ä¸­é…ç½®ï¼š

```json
{
  "scripts": {
    "build:prod": "vite build --mode production",
    "build:prod:memory": "cross-env NODE_OPTIONS=--max-old-space-size=8192 vite build --mode production"
  }
}
```

---

## 6. æ€»ç»“

### æ ¸å¿ƒè¦ç‚¹

1. **æ„å»ºæµç¨‹**ï¼šé…ç½®è§£æ â†’ æ¨¡å—è§£æ â†’ æ¨¡å—è½¬æ¢ â†’ ä¾èµ–åˆ†æ â†’ Chunk åˆ†å‰² â†’ Chunk æ¸²æŸ“ â†’ è¾“å‡º

2. **å†…å­˜é«˜å³°**ï¼šå‘ç”Ÿåœ¨ **Chunk æ¸²æŸ“é˜¶æ®µ**ï¼Œéœ€è¦åŒæ—¶å¤„ç†æ•´ä¸ª chunk çš„ä»£ç å’Œ sourcemap

3. **ä¼˜åŒ–ç­–ç•¥**ï¼š
   - `manualChunks`ï¼šæ‹†åˆ†å¤§ chunkï¼Œåˆ†æ‰¹å¤„ç†
   - `sourcemap-filter`ï¼šåªä¸ºä¸šåŠ¡ä»£ç ç”Ÿæˆæ˜ å°„ï¼Œå‡å°‘ sourcemap æ•°æ®é‡

4. **æœ€ä½³å®è·µ**ï¼šä¸¤è€…ç»“åˆä½¿ç”¨ï¼Œæ—¢æ§åˆ¶å•æ¬¡å¤„ç†é‡ï¼Œåˆå‡å°‘å¤„ç†æ·±åº¦

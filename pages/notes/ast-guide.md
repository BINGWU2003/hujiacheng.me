---
title: AST è¯¦è§£
date: 2026-01-19
duration: 120min
type: notes
art: random
---

[[toc]]

æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç» AST çš„æ¦‚å¿µã€ç»“æ„ã€åœ¨å‰ç«¯æ„å»ºä¸­çš„åº”ç”¨ä»¥åŠç›¸å…³å·¥å…·ã€‚

## ç›®å½•

- [1. ä»€ä¹ˆæ˜¯ ASTï¼Ÿ](#1-ä»€ä¹ˆæ˜¯-ast)
- [2. AST çš„ç»“æ„](#2-ast-çš„ç»“æ„)
- [3. AST åœ¨æ„å»ºä¸­çš„ä½œç”¨](#3-ast-åœ¨æ„å»ºä¸­çš„ä½œç”¨)
- [4. å¸¸ç”¨ AST è§£æå™¨](#4-å¸¸ç”¨-ast-è§£æå™¨)
- [5. AST ä¸å†…å­˜æ¶ˆè€—](#5-ast-ä¸å†…å­˜æ¶ˆè€—)
- [6. AST å®æˆ˜ç¤ºä¾‹](#6-ast-å®æˆ˜ç¤ºä¾‹)

---

## 1. ä»€ä¹ˆæ˜¯ ASTï¼Ÿ

### 1.1 å®šä¹‰

**AST (Abstract Syntax Treeï¼ŒæŠ½è±¡è¯­æ³•æ ‘)** æ˜¯æºä»£ç çš„æ ‘çŠ¶ç»“æ„è¡¨ç¤ºã€‚å®ƒå°†ä»£ç çš„è¯­æ³•ç»“æ„æŠ½è±¡ä¸ºä¸€æ£µæ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä»£è¡¨ä»£ç ä¸­çš„ä¸€ä¸ªè¯­æ³•å•å…ƒã€‚

```
æºä»£ç                           ASTï¼ˆæ ‘çŠ¶ç»“æ„ï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€                       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

const a = 1 + 2;       â†’        Program
                                  â””â”€â”€ VariableDeclaration
                                        â”œâ”€â”€ kind: "const"
                                        â””â”€â”€ declarations
                                              â””â”€â”€ VariableDeclarator
                                                    â”œâ”€â”€ id: Identifier (name: "a")
                                                    â””â”€â”€ init: BinaryExpression
                                                          â”œâ”€â”€ operator: "+"
                                                          â”œâ”€â”€ left: Literal (value: 1)
                                                          â””â”€â”€ right: Literal (value: 2)
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦ ASTï¼Ÿ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä»£ç å¤„ç†çš„æœ¬è´¨                                                                  â”‚
â”‚                                                                                  â”‚
â”‚  æºä»£ç ï¼ˆå­—ç¬¦ä¸²ï¼‰                                                                â”‚
â”‚       â†“                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  "const a = 1 + 2;"                                                         â”‚â”‚
â”‚  â”‚                                                                              â”‚â”‚
â”‚  â”‚  å¯¹äºè®¡ç®—æœºæ¥è¯´ï¼Œè¿™åªæ˜¯ä¸€ä¸²å­—ç¬¦ï¼š                                            â”‚â”‚
â”‚  â”‚  'c','o','n','s','t',' ','a',' ','=',' ','1',' ','+',' ','2',';'            â”‚â”‚
â”‚  â”‚                                                                              â”‚â”‚
â”‚  â”‚  âŒ æ— æ³•ç›´æ¥ç†è§£è¯­ä¹‰                                                         â”‚â”‚
â”‚  â”‚  âŒ æ— æ³•è¿›è¡Œä»£ç è½¬æ¢                                                         â”‚â”‚
â”‚  â”‚  âŒ æ— æ³•è¿›è¡Œä¼˜åŒ–                                                             â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚       â†“ è§£æä¸º AST                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  AST æ ‘çŠ¶ç»“æ„                                                                â”‚â”‚
â”‚  â”‚                                                                              â”‚â”‚
â”‚  â”‚  âœ… å¯ä»¥ç†è§£è¯­ä¹‰ï¼ˆè¿™æ˜¯ä¸€ä¸ªå˜é‡å£°æ˜ï¼‰                                         â”‚â”‚
â”‚  â”‚  âœ… å¯ä»¥éå†å’Œä¿®æ”¹ï¼ˆæŠŠ const æ”¹æˆ letï¼‰                                      â”‚â”‚
â”‚  â”‚  âœ… å¯ä»¥è¿›è¡Œä¼˜åŒ–ï¼ˆå¸¸é‡æŠ˜å ï¼š1 + 2 â†’ 3ï¼‰                                      â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 AST çš„åº”ç”¨åœºæ™¯

| åº”ç”¨åœºæ™¯ | è¯´æ˜ | ç¤ºä¾‹å·¥å…· |
|---------|------|---------|
| **ä»£ç è½¬æ¢** | å°†ä¸€ç§è¯­æ³•è½¬æ¢ä¸ºå¦ä¸€ç§ | Babel (ES6 â†’ ES5) |
| **ä»£ç å‹ç¼©** | åˆ é™¤æ— ç”¨ä»£ç ã€ç¼©çŸ­å˜é‡å | Terser, esbuild |
| **ä»£ç æ£€æŸ¥** | é™æ€åˆ†æã€è§„åˆ™æ£€æµ‹ | ESLint |
| **ä»£ç æ ¼å¼åŒ–** | ç»Ÿä¸€ä»£ç é£æ ¼ | Prettier |
| **ç±»å‹æ£€æŸ¥** | åˆ†æç±»å‹ä¿¡æ¯ | TypeScript |
| **æ‰“åŒ…æ„å»º** | åˆ†æä¾èµ–ã€ä»£ç åˆ†å‰² | Rollup, Webpack |

---

## 2. AST çš„ç»“æ„

### 2.1 åŸºæœ¬èŠ‚ç‚¹ç±»å‹

JavaScript AST éµå¾ª [ESTree è§„èŒƒ](https://github.com/estree/estree)ï¼Œå¸¸è§èŠ‚ç‚¹ç±»å‹ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  èŠ‚ç‚¹ç±»å‹åˆ†ç±»                                                                    â”‚
â”‚                                                                                  â”‚
â”‚  ğŸ“¦ ç¨‹åºèŠ‚ç‚¹                                                                     â”‚
â”‚  â”œâ”€â”€ Program                    ç¨‹åºå…¥å£ï¼ŒåŒ…å«æ‰€æœ‰é¡¶å±‚è¯­å¥                       â”‚
â”‚                                                                                  â”‚
â”‚  ğŸ“ å£°æ˜èŠ‚ç‚¹                                                                     â”‚
â”‚  â”œâ”€â”€ VariableDeclaration        å˜é‡å£°æ˜ (const, let, var)                      â”‚
â”‚  â”œâ”€â”€ FunctionDeclaration        å‡½æ•°å£°æ˜                                        â”‚
â”‚  â”œâ”€â”€ ClassDeclaration           ç±»å£°æ˜                                          â”‚
â”‚  â”œâ”€â”€ ImportDeclaration          import å£°æ˜                                     â”‚
â”‚  â””â”€â”€ ExportDeclaration          export å£°æ˜                                     â”‚
â”‚                                                                                  â”‚
â”‚  ğŸ“‹ è¯­å¥èŠ‚ç‚¹                                                                     â”‚
â”‚  â”œâ”€â”€ ExpressionStatement        è¡¨è¾¾å¼è¯­å¥                                      â”‚
â”‚  â”œâ”€â”€ BlockStatement             å—è¯­å¥ { }                                      â”‚
â”‚  â”œâ”€â”€ IfStatement                if è¯­å¥                                         â”‚
â”‚  â”œâ”€â”€ ForStatement               for å¾ªç¯                                        â”‚
â”‚  â”œâ”€â”€ WhileStatement             while å¾ªç¯                                      â”‚
â”‚  â””â”€â”€ ReturnStatement            return è¯­å¥                                     â”‚
â”‚                                                                                  â”‚
â”‚  ğŸ”¢ è¡¨è¾¾å¼èŠ‚ç‚¹                                                                   â”‚
â”‚  â”œâ”€â”€ Identifier                 æ ‡è¯†ç¬¦ (å˜é‡åã€å‡½æ•°å)                         â”‚
â”‚  â”œâ”€â”€ Literal                    å­—é¢é‡ (æ•°å­—ã€å­—ç¬¦ä¸²ã€å¸ƒå°”å€¼)                   â”‚
â”‚  â”œâ”€â”€ BinaryExpression           äºŒå…ƒè¡¨è¾¾å¼ (a + b, a > b)                       â”‚
â”‚  â”œâ”€â”€ UnaryExpression            ä¸€å…ƒè¡¨è¾¾å¼ (!a, -a)                             â”‚
â”‚  â”œâ”€â”€ CallExpression             å‡½æ•°è°ƒç”¨ (fn())                                 â”‚
â”‚  â”œâ”€â”€ MemberExpression           æˆå‘˜è®¿é—® (obj.prop, arr[0])                     â”‚
â”‚  â”œâ”€â”€ ArrowFunctionExpression    ç®­å¤´å‡½æ•°                                        â”‚
â”‚  â””â”€â”€ ConditionalExpression      ä¸‰å…ƒè¡¨è¾¾å¼ (a ? b : c)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 èŠ‚ç‚¹é€šç”¨å±æ€§

æ¯ä¸ª AST èŠ‚ç‚¹éƒ½åŒ…å«ä»¥ä¸‹é€šç”¨å±æ€§ï¼š

```javascript
{
  type: "Identifier",      // èŠ‚ç‚¹ç±»å‹
  start: 6,                // åœ¨æºç ä¸­çš„èµ·å§‹ä½ç½®
  end: 7,                  // åœ¨æºç ä¸­çš„ç»“æŸä½ç½®
  loc: {                   // ä½ç½®ä¿¡æ¯ï¼ˆè¡Œåˆ—å·ï¼‰
    start: { line: 1, column: 6 },
    end: { line: 1, column: 7 }
  },
  // ... å…¶ä»–ç‰¹å®šå±æ€§
}
```

### 2.3 å®Œæ•´ AST ç¤ºä¾‹

æºä»£ç ï¼š

```javascript
const add = (a, b) => a + b;
```

å¯¹åº”çš„ AST ç»“æ„ï¼š

```javascript
{
  "type": "Program",
  "body": [
    {
      "type": "VariableDeclaration",
      "declarations": [
        {
          "type": "VariableDeclarator",
          "id": {
            "type": "Identifier",
            "name": "add"
          },
          "init": {
            "type": "ArrowFunctionExpression",
            "params": [
              { "type": "Identifier", "name": "a" },
              { "type": "Identifier", "name": "b" }
            ],
            "body": {
              "type": "BinaryExpression",
              "operator": "+",
              "left": { "type": "Identifier", "name": "a" },
              "right": { "type": "Identifier", "name": "b" }
            }
          }
        }
      ],
      "kind": "const"
    }
  ]
}
```

---

## 3. AST åœ¨æ„å»ºä¸­çš„ä½œç”¨

### 3.1 æ„å»ºæµç¨‹ä¸­çš„ AST

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‰ç«¯æ„å»ºæµç¨‹                                                                    â”‚
â”‚                                                                                  â”‚
â”‚  æºä»£ç                                                                           â”‚
â”‚     â”‚                                                                            â”‚
â”‚     â–¼                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  1ï¸âƒ£ è¯æ³•åˆ†æ (Lexical Analysis)                               â”‚              â”‚
â”‚  â”‚                                                                â”‚              â”‚
â”‚  â”‚  "const a = 1 + 2;"                                            â”‚              â”‚
â”‚  â”‚       â†“                                                        â”‚              â”‚
â”‚  â”‚  [CONST] [ID:a] [=] [NUM:1] [+] [NUM:2] [;]                    â”‚              â”‚
â”‚  â”‚                                                                â”‚              â”‚
â”‚  â”‚  å°†ä»£ç æ‹†åˆ†ä¸º Tokenï¼ˆè¯æ³•å•å…ƒï¼‰                                 â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚     â”‚                                                                            â”‚
â”‚     â–¼                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  2ï¸âƒ£ è¯­æ³•åˆ†æ (Syntax Analysis)                                 â”‚              â”‚
â”‚  â”‚                                                                â”‚              â”‚
â”‚  â”‚  Token æµ                                                      â”‚              â”‚
â”‚  â”‚       â†“                                                        â”‚              â”‚
â”‚  â”‚  AST æ ‘çŠ¶ç»“æ„                                                  â”‚              â”‚
â”‚  â”‚                                                                â”‚              â”‚
â”‚  â”‚  å°† Token ç»„ç»‡æˆè¯­æ³•æ ‘                                         â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚     â”‚                                                                            â”‚
â”‚     â–¼                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  3ï¸âƒ£ è¯­ä¹‰åˆ†æ & è½¬æ¢ (Semantic Analysis & Transform)            â”‚              â”‚
â”‚  â”‚                                                                â”‚              â”‚
â”‚  â”‚  â€¢ å˜é‡ä½œç”¨åŸŸåˆ†æ                                               â”‚              â”‚
â”‚  â”‚  â€¢ ç±»å‹æ£€æŸ¥ï¼ˆTypeScriptï¼‰                                       â”‚              â”‚
â”‚  â”‚  â€¢ ä»£ç è½¬æ¢ï¼ˆES6 â†’ ES5ï¼‰                                        â”‚              â”‚
â”‚  â”‚  â€¢ ä¼˜åŒ–ï¼ˆæ­»ä»£ç æ¶ˆé™¤ã€å¸¸é‡æŠ˜å ï¼‰                                  â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚     â”‚                                                                            â”‚
â”‚     â–¼                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  4ï¸âƒ£ ä»£ç ç”Ÿæˆ (Code Generation)                                 â”‚              â”‚
â”‚  â”‚                                                                â”‚              â”‚
â”‚  â”‚  AST                                                           â”‚              â”‚
â”‚  â”‚       â†“                                                        â”‚              â”‚
â”‚  â”‚  ç›®æ ‡ä»£ç ï¼ˆå­—ç¬¦ä¸²ï¼‰                                             â”‚              â”‚
â”‚  â”‚                                                                â”‚              â”‚
â”‚  â”‚  å°† AST è½¬æ¢å›ä»£ç å­—ç¬¦ä¸²                                        â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚     â”‚                                                                            â”‚
â”‚     â–¼                                                                            â”‚
â”‚  è¾“å‡ºæ–‡ä»¶                                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 Vite/Rollup ä¸­çš„ AST åº”ç”¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Rollup ä½¿ç”¨ AST çš„åœºæ™¯                                                          â”‚
â”‚                                                                                  â”‚
â”‚  1ï¸âƒ£ ä¾èµ–åˆ†æ                                                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                                   â”‚
â”‚  è§£æ import/export è¯­å¥ï¼Œæ„å»ºä¾èµ–å›¾                                             â”‚
â”‚                                                                                  â”‚
â”‚  // æºä»£ç                                                                        â”‚
â”‚  import { ref } from 'vue';                                                      â”‚
â”‚                                                                                  â”‚
â”‚  // Rollup é€šè¿‡ AST åˆ†æå‡ºï¼š                                                     â”‚
â”‚  // - å¯¼å…¥æ¥æºï¼š'vue'                                                            â”‚
â”‚  // - å¯¼å…¥å†…å®¹ï¼šref                                                              â”‚
â”‚  // - æ˜¯å¦æœ‰ side effect                                                         â”‚
â”‚                                                                                  â”‚
â”‚  2ï¸âƒ£ Tree Shaking                                                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                                â”‚
â”‚  åˆ†æå“ªäº›å¯¼å‡ºè¢«ä½¿ç”¨ï¼Œåˆ é™¤æœªä½¿ç”¨çš„ä»£ç                                             â”‚
â”‚                                                                                  â”‚
â”‚  // utils.js                                                                     â”‚
â”‚  export const used = () => {};      // âœ… ä¿ç•™                                  â”‚
â”‚  export const unused = () => {};    // âŒ åˆ é™¤ï¼ˆæœªè¢«å¼•ç”¨ï¼‰                       â”‚
â”‚                                                                                  â”‚
â”‚  3ï¸âƒ£ ä»£ç è½¬æ¢                                                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                                   â”‚
â”‚  è½¬æ¢è¯­æ³•ã€æ³¨å…¥ä»£ç ã€æ›¿æ¢å˜é‡                                                    â”‚
â”‚                                                                                  â”‚
â”‚  // å¼€å‘ç¯å¢ƒ                                      // ç”Ÿäº§ç¯å¢ƒ                   â”‚
â”‚  if (process.env.NODE_ENV === 'development') â†’   if (false) { ... }            â”‚
â”‚                                                   // ç„¶åé€šè¿‡ DCE åˆ é™¤           â”‚
â”‚                                                                                  â”‚
â”‚  4ï¸âƒ£ ä»£ç å‹ç¼©                                                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                                   â”‚
â”‚  ç¼©çŸ­å˜é‡åã€åˆ é™¤ç©ºç™½ã€å†…è”å¸¸é‡                                                  â”‚
â”‚                                                                                  â”‚
â”‚  // å‹ç¼©å‰                              // å‹ç¼©å                                â”‚
â”‚  const calculateSum = (a, b) => {  â†’   const t=(e,n)=>e+n;                      â”‚
â”‚    return a + b;                                                                 â”‚
â”‚  };                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 å¸¸è§çš„ AST è½¬æ¢æ“ä½œ

| æ“ä½œç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|---------|------|------|
| **éå† (Traverse)** | è®¿é—®æ¯ä¸ªèŠ‚ç‚¹ | æŸ¥æ‰¾æ‰€æœ‰å‡½æ•°å£°æ˜ |
| **ä¿®æ”¹ (Modify)** | æ”¹å˜èŠ‚ç‚¹å±æ€§ | å°† `var` æ”¹ä¸º `let` |
| **åˆ é™¤ (Remove)** | ç§»é™¤èŠ‚ç‚¹ | åˆ é™¤ console.log |
| **æ’å…¥ (Insert)** | æ·»åŠ æ–°èŠ‚ç‚¹ | æ³¨å…¥ polyfill |
| **æ›¿æ¢ (Replace)** | ç”¨æ–°èŠ‚ç‚¹æ›¿æ¢æ—§èŠ‚ç‚¹ | å¸¸é‡æŠ˜å  `1+2` â†’ `3` |

---

## 4. å¸¸ç”¨ AST è§£æå™¨

### 4.1 JavaScript è§£æå™¨å¯¹æ¯”

| è§£æå™¨ | ç‰¹ç‚¹ | ä½¿ç”¨åœºæ™¯ |
|-------|------|---------|
| **Acorn** | è½»é‡ã€å¿«é€Ÿã€ESTree æ ‡å‡† | Rollup é»˜è®¤è§£æå™¨ |
| **@babel/parser** | æ”¯æŒæœ€æ–°è¯­æ³•ã€æ’ä»¶ä¸°å¯Œ | Babel ç”Ÿæ€ |
| **Esprima** | è€ç‰Œè§£æå™¨ã€ç¨³å®š | ESLint æ—©æœŸç‰ˆæœ¬ |
| **TypeScript** | æ”¯æŒ TS è¯­æ³• | TypeScript ç¼–è¯‘ |
| **SWC** | Rust ç¼–å†™ã€æå¿« | æ–°ä¸€ä»£æ„å»ºå·¥å…· |
| **esbuild** | Go ç¼–å†™ã€æå¿« | Vite å¼€å‘æœåŠ¡å™¨ |

### 4.2 æ€§èƒ½å¯¹æ¯”

```
è§£æ 1MB JavaScript ä»£ç çš„æ—¶é—´ï¼ˆå‚è€ƒå€¼ï¼‰ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è§£æå™¨           æ—¶é—´                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  Acorn           ~100ms    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                            â”‚
â”‚  @babel/parser   ~150ms    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                      â”‚
â”‚  Esprima         ~120ms    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                         â”‚
â”‚  TypeScript      ~200ms    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                â”‚
â”‚  SWC             ~20ms     â–ˆâ–ˆâ–ˆ                                     â”‚
â”‚  esbuild         ~15ms     â–ˆâ–ˆ                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ³¨ï¼šSWC å’Œ esbuild ä½¿ç”¨ç³»ç»Ÿè¯­è¨€ï¼ˆRust/Goï¼‰ç¼–å†™ï¼Œæ€§èƒ½è¿œè¶… JS å®ç°
```

### 4.3 åœ¨çº¿ AST å·¥å…·

- [AST Explorer](https://astexplorer.net/) - åœ¨çº¿æŸ¥çœ‹å„ç§è¯­è¨€çš„ AST
- [Babel REPL](https://babeljs.io/repl) - æŸ¥çœ‹ Babel è½¬æ¢ç»“æœ
- [TypeScript Playground](https://www.typescriptlang.org/play) - TypeScript AST

---

## 5. AST ä¸å†…å­˜æ¶ˆè€—

### 5.1 ä¸ºä»€ä¹ˆ AST æ¶ˆè€—å†…å­˜ï¼Ÿ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AST å†…å­˜æ¶ˆè€—åˆ†æ                                                                â”‚
â”‚                                                                                  â”‚
â”‚  æºä»£ç å¤§å° vs AST å¤§å°ï¼š                                                        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                        â”‚
â”‚  æºä»£ç : "const a = 1 + 2;"  (18 bytes)                                         â”‚
â”‚                                                                                  â”‚
â”‚  AST å¯¹è±¡:                                                                       â”‚
â”‚  {                                                                               â”‚
â”‚    type: "Program",                    // å¯¹è±¡å¼€é”€ ~50 bytes                    â”‚
â”‚    body: [{                                                                      â”‚
â”‚      type: "VariableDeclaration",      // å¯¹è±¡å¼€é”€ ~50 bytes                    â”‚
â”‚      declarations: [{                                                            â”‚
â”‚        type: "VariableDeclarator",     // å¯¹è±¡å¼€é”€ ~50 bytes                    â”‚
â”‚        id: {                                                                     â”‚
â”‚          type: "Identifier",           // å¯¹è±¡å¼€é”€ ~50 bytes                    â”‚
â”‚          name: "a"                                                               â”‚
â”‚        },                                                                        â”‚
â”‚        init: {                                                                   â”‚
â”‚          type: "BinaryExpression",     // å¯¹è±¡å¼€é”€ ~50 bytes                    â”‚
â”‚          operator: "+",                                                          â”‚
â”‚          left: {...},                  // å¯¹è±¡å¼€é”€ ~50 bytes                    â”‚
â”‚          right: {...}                  // å¯¹è±¡å¼€é”€ ~50 bytes                    â”‚
â”‚        }                                                                         â”‚
â”‚      }],                                                                         â”‚
â”‚      kind: "const"                                                               â”‚
â”‚    }]                                                                            â”‚
â”‚  }                                                                               â”‚
â”‚                                                                                  â”‚
â”‚  ğŸ“Š AST å¤§å° â‰ˆ 350+ bytesï¼ˆçº¦ä¸ºæºä»£ç çš„ 20 å€ï¼ï¼‰                                â”‚
â”‚                                                                                  â”‚
â”‚  åŸå› ï¼š                                                                          â”‚
â”‚  1. æ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä¸€ä¸ª JS å¯¹è±¡ï¼Œæœ‰å›ºå®šå¼€é”€                                         â”‚
â”‚  2. åŒ…å«å¤§é‡å…ƒæ•°æ®ï¼ˆä½ç½®ä¿¡æ¯ã€ä½œç”¨åŸŸä¿¡æ¯ï¼‰                                       â”‚
â”‚  3. å¯¹è±¡å¼•ç”¨å’ŒæŒ‡é’ˆä¹Ÿå ç”¨å†…å­˜                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 å¤§æ–‡ä»¶çš„ AST å†…å­˜é—®é¢˜

```
æ–‡ä»¶å¤§å°ä¸ AST å†…å­˜æ¶ˆè€—å¯¹ç…§ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æºä»£ç å¤§å°        AST å†…å­˜          å¤‡æ³¨                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  10 KB            ~200 KB           å°å‹ç»„ä»¶                       â”‚
â”‚  100 KB           ~2 MB             ä¸­å‹æ¨¡å—                       â”‚
â”‚  1 MB             ~20 MB            å¤§å‹åº“                         â”‚
â”‚  10 MB            ~200 MB           å·¨å‹ bundle                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ’¥ åœ¨æ„å»ºè¿‡ç¨‹ä¸­ï¼Œå¯èƒ½åŒæ—¶è§£æå¤šä¸ªå¤§æ–‡ä»¶ï¼š
   5 ä¸ª 1MB æ–‡ä»¶ = 5 Ã— 20MB = 100MB AST å†…å­˜
   åŠ ä¸Šå…¶ä»–å¤„ç†å¼€é”€ï¼Œæ€»å†…å­˜å¯èƒ½è¾¾åˆ° 300-500MB
```

### 5.3 AST ç›¸å…³çš„å†…å­˜ä¼˜åŒ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¼˜åŒ–ç­–ç•¥                                                                        â”‚
â”‚                                                                                  â”‚
â”‚  1ï¸âƒ£ æµå¼å¤„ç†                                                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                                   â”‚
â”‚  ä¸ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰æ–‡ä»¶çš„ ASTï¼Œè€Œæ˜¯æŒ‰éœ€è§£æ                                        â”‚
â”‚                                                                                  â”‚
â”‚  2ï¸âƒ£ åŠæ—¶é‡Šæ”¾                                                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                                   â”‚
â”‚  å¤„ç†å®Œä¸€ä¸ªæ–‡ä»¶åï¼Œç«‹å³é‡Šæ”¾å…¶ ASTï¼Œè®© GC å›æ”¶                                    â”‚
â”‚                                                                                  â”‚
â”‚  3ï¸âƒ£ ä½¿ç”¨åŸç”Ÿè§£æå™¨                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                               â”‚
â”‚  SWCã€esbuild ç­‰åŸç”Ÿè§£æå™¨å†…å­˜æ•ˆç‡æ›´é«˜                                           â”‚
â”‚                                                                                  â”‚
â”‚  4ï¸âƒ£ å‡å°‘è½¬æ¢å±‚æ•°                                                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                                â”‚
â”‚  æ¯æ¬¡è½¬æ¢éƒ½éœ€è¦åˆ›å»ºæ–° ASTï¼Œå‡å°‘ä¸å¿…è¦çš„è½¬æ¢                                      â”‚
â”‚                                                                                  â”‚
â”‚  5ï¸âƒ£ æ‹†åˆ†å¤§æ–‡ä»¶                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                                   â”‚
â”‚  å°†å¤§å‹æ¨¡å—æ‹†åˆ†ä¸ºå¤šä¸ªå°æ–‡ä»¶ï¼Œå‡å°‘å•æ¬¡è§£æçš„å†…å­˜                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. AST å®æˆ˜ç¤ºä¾‹

### 6.1 ä½¿ç”¨ Acorn è§£æä»£ç 

```javascript
// å®‰è£…ï¼šnpm install acorn
const acorn = require('acorn');

const code = `
const greet = (name) => {
  console.log('Hello, ' + name);
};
`;

// è§£æä¸º AST
const ast = acorn.parse(code, {
  ecmaVersion: 2020,
  sourceType: 'module',
});

console.log(JSON.stringify(ast, null, 2));
```

### 6.2 ä½¿ç”¨ Babel è½¬æ¢ä»£ç 

```javascript
// å®‰è£…ï¼šnpm install @babel/core @babel/preset-env
const babel = require('@babel/core');

const code = `const fn = () => 'hello';`;

// è½¬æ¢ ES6 ç®­å¤´å‡½æ•°ä¸º ES5 å‡½æ•°
const result = babel.transformSync(code, {
  presets: ['@babel/preset-env'],
});

console.log(result.code);
// è¾“å‡º: "use strict"; var fn = function fn() { return 'hello'; };
```

### 6.3 ç¼–å†™ç®€å•çš„ AST è½¬æ¢æ’ä»¶

```javascript
// Babel æ’ä»¶ï¼šå°†æ‰€æœ‰ console.log æ›¿æ¢ä¸º console.warn
module.exports = function () {
  return {
    visitor: {
      // è®¿é—®æ‰€æœ‰å‡½æ•°è°ƒç”¨è¡¨è¾¾å¼
      CallExpression(path) {
        const { callee } = path.node;
        
        // æ£€æŸ¥æ˜¯å¦æ˜¯ console.log
        if (
          callee.type === 'MemberExpression' &&
          callee.object.name === 'console' &&
          callee.property.name === 'log'
        ) {
          // ä¿®æ”¹ä¸º console.warn
          callee.property.name = 'warn';
        }
      },
    },
  };
};

// ä½¿ç”¨
// babel.transformSync(code, { plugins: [ä¸Šé¢çš„æ’ä»¶] });
```

### 6.4 ä½¿ç”¨ ESLint è§„åˆ™åˆ†æ AST

```javascript
// ESLint è‡ªå®šä¹‰è§„åˆ™ï¼šç¦æ­¢ä½¿ç”¨ var
module.exports = {
  meta: {
    type: 'suggestion',
    docs: {
      description: 'Disallow var declarations',
    },
    fixable: 'code',
  },
  create(context) {
    return {
      // è®¿é—®æ‰€æœ‰å˜é‡å£°æ˜
      VariableDeclaration(node) {
        if (node.kind === 'var') {
          context.report({
            node,
            message: 'ä½¿ç”¨ const æˆ– let æ›¿ä»£ var',
            fix(fixer) {
              // è‡ªåŠ¨ä¿®å¤ï¼šå°† var æ›¿æ¢ä¸º let
              return fixer.replaceTextRange(
                [node.start, node.start + 3],
                'let'
              );
            },
          });
        }
      },
    };
  },
};
```

---

## 7. AST ä¸ Sourcemap çš„å…³ç³»

### 7.1 ä½ç½®è¿½è¸ª

AST èŠ‚ç‚¹çš„ä½ç½®ä¿¡æ¯æ˜¯ç”Ÿæˆ Sourcemap çš„åŸºç¡€ï¼š

```
æºä»£ç è½¬æ¢è¿‡ç¨‹ï¼š

ES6 ä»£ç                         AST (with location)                 ES5 ä»£ç 
â”€â”€â”€â”€â”€â”€â”€â”€â”€                       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”€â”€â”€â”€â”€â”€â”€â”€â”€

const a = 1;                    Identifier {                        var a = 1;
      ^                           name: "a",                              ^
      |                           loc: { start: { line: 1, col: 6 } }     |
      |                         }                                         |
      |                                                                   |
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Sourcemap æ˜ å°„ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               
                               ES5 ç¬¬1è¡Œç¬¬4åˆ— â† å¯¹åº” â†’ ES6 ç¬¬1è¡Œç¬¬6åˆ—
```

### 7.2 è½¬æ¢è¿‡ç¨‹ä¸­çš„ä½ç½®ç»´æŠ¤

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¤šæ¬¡è½¬æ¢çš„ä½ç½®è¿½è¸ª                                                              â”‚
â”‚                                                                                  â”‚
â”‚  TypeScript            â†’            JavaScript           â†’          å‹ç¼©ä»£ç     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                         â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                       â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  const a: number = 1;    è½¬æ¢1      const a = 1;          è½¬æ¢2      var a=1;   â”‚
â”‚        ^                                 ^                                ^      â”‚
â”‚        |                                 |                                |      â”‚
â”‚   ä½ç½®: (1,6)     â†’     Sourcemap 1 â†’   ä½ç½®: (1,6)   â†’  Sourcemap 2 â†’  ä½ç½®:(1,4)â”‚
â”‚                                                                                  â”‚
â”‚                   æœ€ç»ˆ Sourcemap = Sourcemap 1 + Sourcemap 2                     â”‚
â”‚                   å‹ç¼©ä»£ç  (1,4) â†’ åŸå§‹ TS (1,6)                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. æ€»ç»“

### æ ¸å¿ƒè¦ç‚¹

1. **AST æ˜¯ä»£ç çš„ç»“æ„åŒ–è¡¨ç¤º**ï¼Œè®©ç¨‹åºèƒ½ç†è§£å’Œæ“ä½œä»£ç 

2. **AST åœ¨æ„å»ºä¸­çš„åº”ç”¨**ï¼š
   - ä¾èµ–åˆ†æ
   - Tree Shaking
   - ä»£ç è½¬æ¢
   - ä»£ç å‹ç¼©

3. **AST çš„å†…å­˜ç‰¹ç‚¹**ï¼š
   - AST å¤§å°çº¦ä¸ºæºä»£ç çš„ 10-20 å€
   - å¤§æ–‡ä»¶çš„ AST ä¼šæ¶ˆè€—å¤§é‡å†…å­˜
   - å¯é€šè¿‡æµå¼å¤„ç†ã€åŸç”Ÿè§£æå™¨ç­‰æ–¹å¼ä¼˜åŒ–

4. **AST ä¸ Sourcemap çš„å…³ç³»**ï¼š
   - AST èŠ‚ç‚¹çš„ä½ç½®ä¿¡æ¯æ˜¯ Sourcemap çš„åŸºç¡€
   - å¤šæ¬¡è½¬æ¢éœ€è¦é“¾æ¥å¤šä¸ª Sourcemap

